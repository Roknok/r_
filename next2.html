<script>
  const baseElements = ["Water", "Scissors", "Great", "Rocks", "Stars", "Fire", "Cloud", "Paper"];
  const combinations = {
    "Water+Scissors": "Rusted Scissors",
    "Rocks+Scissors": "Broken Scissors",
    "Great+Water": "Waterfall",
    "Scissors+Great": "Raunak",
    "Raunak+Rocks": "Roknok",
    "Rusted Scissors+Fire": "Scissors",
    "Water+Fire": "Steam",
    "Cloud+Fire": "Lightning",
    "Cloud+Water": "Rain",
    "Rain+Stars": "Rainbow",
    "Paper+Fire": "Ash",
    "Water+Paper": "Wet Paper",
    "Stars+Paper": "Constellation Map",
    "Great+Rocks": "Mountains",
    "Rocks+Fire": "Lava",
    "Cloud+Stars": "Night Sky",
    "Paper+Scissors": "Cut Paper",
    "Cloud+Paper": "Paper Plane",
    "Stars+Fire": "Nova",
    "Rocks+Stars": "Meteorite",
    "Scissors+Paper": "Victory",
    "Raunak+Stars": "Rising Star",
    "Water+Cloud": "Fog",
    "Great+Fire": "Explosion",
    "Great+Stars": "Supernova",
    "Rocks+Cloud": "Cave",
    "Scissors+Fire": "Hot Blades",
    "Water+Stars": "Reflection",
    "Paper+Great": "Scroll",
    "Raunak+Paper": "Poem",
    "Raunak+Fire": "Flameheart",
    "Raunak+Great": "Legend",
    "Roknok+Stars": "Celestial Being",
    "Roknok+Fire": "Infernal Titan",
    "Roknok+Great": "Overlord",
    "Roknok+Scissors": "Blade King",
    "Roknok+Water": "Tidewalker"
  };

  const slotValues = { slot1: null, slot2: null };

  function allowDrop(event) {
    event.preventDefault();
  }

  function drag(event) {
    event.dataTransfer.setData("text/plain", event.target.textContent);
  }

  function drop(event, slot) {
    event.preventDefault();
    const data = event.dataTransfer.getData("text/plain");
    setSlotValue(slot, data);
  }

  function setSlotValue(slot, value) {
    document.getElementById(slot).textContent = value;
    slotValues[slot] = value;
    if (slotValues.slot1 && slotValues.slot2) {
      const combo1 = `${slotValues.slot1}+${slotValues.slot2}`;
      const combo2 = `${slotValues.slot2}+${slotValues.slot1}`;
      const result = combinations[combo1] || combinations[combo2] || `${slotValues.slot1}${slotValues.slot2}`;
      document.getElementById('result').textContent = result;
      document.getElementById('addToInventoryBtn').style.display = 'inline';
    }
  }

  function addToInventory() {
    const result = document.getElementById('result').textContent;
    if (result) {
      const container = document.getElementById('elementsContainer');
      if (!Array.from(container.children).some(box => box.textContent === result)) {
        const newBox = createBox(result);
        container.appendChild(newBox);
      }
      for (let key in slotValues) {
        if (slotValues[key]) {
          const element = Array.from(container.children).find(box => box.textContent === slotValues[key]);
          if (element) element.remove();
        }
      }
      document.getElementById('addToInventoryBtn').style.display = 'none';
      clearSlots();
    }
  }

  function createBox(text) {
    const box = document.createElement('div');
    box.className = 'box';
    box.draggable = true;
    box.textContent = text;
    box.ondragstart = drag;

    // Mobile support
    box.addEventListener('touchstart', touchStart);
    box.addEventListener('touchend', touchEnd);
    return box;
  }

  let touchItem = null;

  function touchStart(e) {
    touchItem = e.target.textContent;
  }

  function touchEnd(e) {
    const touch = e.changedTouches[0];
    const target = document.elementFromPoint(touch.clientX, touch.clientY);
    if (target && target.classList.contains('slot')) {
      const slotId = target.id;
      setSlotValue(slotId, touchItem);
    }
    touchItem = null;
  }

  function clearSlots() {
    document.getElementById('slot1').textContent = '';
    document.getElementById('slot2').textContent = '';
    document.getElementById('result').textContent = '';
    slotValues.slot1 = null;
    slotValues.slot2 = null;
  }

  function resetGame() {
    const container = document.getElementById('elementsContainer');
    container.innerHTML = '';
    baseElements.forEach(e => container.appendChild(createBox(e)));
    clearSlots();
    document.getElementById('ronokSlot').textContent = '';
    document.getElementById('proceedContainer').classList.remove('show');
  }

  function checkRonok(event) {
    event.preventDefault();
    const data = event.dataTransfer.getData("text/plain");
    document.getElementById('ronokSlot').textContent = data;
    if (data === 'Roknok') {
      document.getElementById('proceedContainer').classList.add('show');
    }
  }

  // Support mobile dropping Roknok manually
  document.getElementById('ronokSlot').addEventListener('touchend', function (e) {
    const touch = e.changedTouches[0];
    const target = document.elementFromPoint(touch.clientX, touch.clientY);
    if (touchItem === 'Roknok' && target && target.id === 'ronokSlot') {
      document.getElementById('ronokSlot').textContent = 'Roknok';
      document.getElementById('proceedContainer').classList.add('show');
    }
  });

  resetGame();
</script>
